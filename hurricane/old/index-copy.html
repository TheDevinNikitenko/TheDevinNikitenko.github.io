<!DOCTYPE html>
<html>
<head>
    <style> html, body, #map { height: 100%; width: 100%; padding: 0; margin: 0; } </style>
    <!-- Leaflet (JS/CSS) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <!-- Leaflet-KMZ -->
    <script src="https://unpkg.com/leaflet-kmz@latest/dist/leaflet-kmz.js"></script>
    <title>Weather Watchers | Map</title>
    
</head>
<body>
    <div id="map"></div>
        <script>
//Active Alerts
        async function fetchGeoJSONData() {
            try {
                const response = await fetch('https://api.weather.gov/alerts/active?limit=500');
                const data = await response.json();
                return data.features;
            } catch (error) {
                console.error('Error fetching GeoJSON data:', error);
                return [];
            }
        }

//Main Map Things
        async function initializeMap() {
            map = L.map('map').setView([37.7749, -122.4194], 6);

            // Add an OpenStreetMap tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            const geoJSONData = await fetchGeoJSONData();

            // Create a GeoJSON layer and add it to the map
            L.geoJSON(geoJSONData, {
                style: {
                    fillColor: 'rgba(0, 255, 0, 0.3)',
                    color: 'green',
                    weight: 2
                },
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.event + '<br>' + feature.properties.description);
                }
            }).addTo(map);

        }

        initializeMap();

//LOAD THE FUCKING KMZ FILE YOU WHORE
        var kmz = L.kmzLayer().addTo(map);
      
        kmz.on('load', function(e) {
            var layer = e.layer;
            control.addOverlay(layer, e.name);
        
            // Apply specific styling for each KMZ layer
            if (e.name === 'AL102023_CONE_latest.kmz') {
                layer.setStyle({
                    fillOpacity: 0.3,
                    color: 'black',
                    weight: 3
                });
            } else if (e.name === 'AL102023_TRACK_latest.kmz') {
                layer.setStyle({
                    fillOpacity: 0,
                    color: 'black',
                    weight: 3,
                });
            } else {
                layer.setStyle({
                    fillOpacity: 0,
                    weight: 3
                });
            }
        });
      
        // Add remote KMZ files as layers (NB if they are 3rd-party servers, they MUST have CORS enabled)
        kmz.load('https://corsproxy.io/?https://www.nhc.noaa.gov/storm_graphics/api/AL102023_CONE_latest.kmz');
        kmz.load('https://corsproxy.io/?https://www.nhc.noaa.gov/storm_graphics/api/AL102023_TRACK_latest.kmz');
        kmz.load('https://corsproxy.io/?https://www.nhc.noaa.gov/storm_graphics/api/AL102023_WW_latest.kmz');
      
        var control = L.control.layers(null, null, { collapsed:false }).addTo(map);
        </script>
</body>
</html>
